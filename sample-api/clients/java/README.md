# ToDoItem Sample API Java Kiota Client

This sample implements a client for the [ToDoItem sample API](../../api). It includes an SDK generated by Kiota in the [utilities/src](./utilities/src/) folder.

The SDK was generated using the command in [makesdk.bat](makesdk.bat). You can use the makesdk.bat file or the following command to regenerate the SDK.

```powershell
kiota -l java -c ToDoApiClient -n todoclient.utilities -d https://localhost:7206/openapi/openapi.yaml -o ./utilities/src/main/java/todoclient/utilities
```

## Prerequisites

- [JDK 17](https://adoptium.net/)
- [Gradle 7](https://gradle.org/install/)
- An Azure account with an active subscription. Create an [Azure account for free](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) or [join the Microsoft 365 Developer Program](https://developer.microsoft.com/office/dev-program) to get a free instant sandbox for testing.
- The Azure account must have permission to manage applications in Azure Active Directory (Azure AD). Any of the following Azure AD roles include the required permissions:
  - Application administrator
  - Application developer
  - Cloud application administrator
  - Global administrator

- The [ToDoItem sample API](../../api) running on your local machine.

## Configure the sample

The sample API uses [Azure AD to protect the Web API](https://docs.microsoft.com/azure/active-directory/develop/scenario-protected-web-api-overview). In order to authenticate and get access tokens to access the API, you'll need to [register an application in Azure AD](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app) for this sample client and add the app registration to the sample. You can install the [Microsoft Graph PowerShell SDK](https://github.com/microsoftgraph/msgraph-sdk-powershell) and use the included [PowerShell script](RegisterApp.ps1) to automate the process, or register the app manually.

### Use PowerShell

**Note:** The PowerShell script requires an account with the Application administrator, Cloud application administrator, or Global administrator role. If your account has the Application developer role, you can [register manually](#register-manually).

Open PowerShell in the root of this project and run the following command.

```powershell
.\RegisterApp.ps1
```

This will open a browser window to the Microsoft identity platform's sign-in page. Sign in with your Azure account, review the requested permissions, and consent to the application. This creates an app registration named `Kiota ToDoItem Sample API Java Client` and save the needed configuration in `./app/src/main/resources/todoclient/settings/azure.properties`.

The script also accepts optional parameters to change how it behaves.

- `-AppName <string>`: Set the name of the app registration
- `-TenantId <string>`: Specify the tenant ID of the Azure subscription to create the app registration in.
- `-StayConnected`: The script will leave the Microsoft Graph PowerShell SDK's session open rather than disconnect when it is finished.

### Register manually

1. Open a browser and navigate to the [Azure Active Directory admin center](https://aad.portal.azure.com). Login with your Azure account.
1. Select **Azure Active Directory** in the left-hand navigation, then select **App registrations** under **Manage**.
1. Select **New registration**. On the **Register an application** page, set the values as follows.

    - Set **Name** to `Kiota ToDoItem Sample API Java Client`.
    - Set **Supported account types** to **Accounts in this organizational directory only**.
    - Leave **Redirect URI** blank.

1. Select **Register**. On the **Kiota ToDoItem Sample API .NET Client** page, copy the values of the **Application (client) ID** and **Directory (tenant) ID and save them, you will need to add them to the sample once you are done configuring the app registration.

1. Select **Authentication** under **Manage**.
1. Locate the **Advanced settings** section. Set the **Allow public client flows** toggle to **Yes**, then select **Save**.
1. Create a new file in the [./app/src/main/resources/todoclient/settings](/app/src/main/resources/todoclient/settings) directory named **azure.properties** and add the following contents. Replace `YOUR_CLIENT_ID` with the client ID from your app registration, and replace `YOUR_TENANT_ID` with your tenant ID.

    ```groovy
    azure.clientId=YOUR_CLIENT_ID
    azure.tenantId=YOUR_TENANT_ID
    azure.scopes='api://YOUR_TODO_API_CLIENT_ID/ToDoItem.ReadWrite'
    ```

## Run the sample

Before running the sample client, make sure that you have the sample API project running on your local machine.

### Add the API's scope to azure.properties

Update the `azure.scopes` value by replacing `YOUR_TODO_API_CLIENT_ID` with the client ID for the sample API's app registration.

### Add ASP.NET development certificate to project

Run the following command to export the ASP.NET development certificate.

```bash
dotnet dev-certs https -ep ./ToDoItemAPICert.pfx -p <secure-password>
```

Copy **ToDoItemAPICert.pfx** into the `./app/src/main/resources/todoclient/http` directory.

Create a new file in `./app/src/main/resources/todoclient/http` named **devcert.properties** and add the following, replacing `YOUR_CERT_PASSWORD` with the password you provided in the previous step.

```groovy
certfile=ToDoItemAPICert.pfx
certpassword=YOUR_CERT_PASSWORD
```

> **NOTE:** You'll need to generate a GitHub personal access token with the `read:packages` permission, then add your GitHub username and PAT in a new file named **gradle.properties** in the root of this project. Microsoft employees must also enable SSO for the Microsoft organization on the PAT. This is a temporary requirement until the Kiota team publishes the Kiota libraries to maven.org.
>
> ```groovy
> gpr.user = YOUR_GITHUB_USERNAME
> gpr.key = YOUR_GITHUB_PAT
> ```

Start the sample with the `./gradlew --console plain run` command in the root directory. Alternatively, you can open this project folder with [Visual Studio Code](https://code.visualstudio.com/Download) or open **ToDoClient.csproj** with [Visual Studio](https://visualstudio.microsoft.com/downloads/) and debug the code by pressing **F5**.

The application prompts for authenticate in a browser.

```powershell
To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code F8HNE7ABP to authenticate.
```
